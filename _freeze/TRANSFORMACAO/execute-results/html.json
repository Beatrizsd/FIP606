{
  "hash": "a14d0060ce80141ea37241756acf9860",
  "result": {
    "markdown": "---\ntitle: \"\"\n---\n\n\n# Transformação de dados\n\nA transformação é necessária quando os dados não atendem a premissas de normalidade dos resíduos e homogeneidade de variâncias\n\n\n::: {.cell hash='TRANSFORMACAO_cache/html/unnamed-chunk-1_c72ee10fa190328db221bb1642002970'}\n\n```{.r .cell-code}\n# vamos usar o conjunto de dados do R \"InsectSpray\"\nlibrary(tidyverse)\ninseticida <- InsectSprays\n```\n:::\n\n\n### visualizar\n\n\n::: {.cell hash='TRANSFORMACAO_cache/html/unnamed-chunk-2_56a9222078639abc91493175852a2146'}\n\n```{.r .cell-code}\ninseticida |>\n  ggplot(aes(spray,count))+\n  geom_boxplot()\n```\n\n::: {.cell-output-display}\n![](TRANSFORMACAO_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n### Ajustar anova e trabalhar com os resíduos\n\n\n::: {.cell hash='TRANSFORMACAO_cache/html/unnamed-chunk-3_92421170a98f8f0b23ad2cf680d3509a'}\n\n```{.r .cell-code}\nm1 <- lm(count ~spray, data = inseticida)\nsummary(m1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = count ~ spray, data = inseticida)\n\nResiduals:\n   Min     1Q Median     3Q    Max \n-8.333 -1.958 -0.500  1.667  9.333 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  14.5000     1.1322  12.807  < 2e-16 ***\nsprayB        0.8333     1.6011   0.520    0.604    \nsprayC      -12.4167     1.6011  -7.755 7.27e-11 ***\nsprayD       -9.5833     1.6011  -5.985 9.82e-08 ***\nsprayE      -11.0000     1.6011  -6.870 2.75e-09 ***\nsprayF        2.1667     1.6011   1.353    0.181    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 3.922 on 66 degrees of freedom\nMultiple R-squared:  0.7244,\tAdjusted R-squared:  0.7036 \nF-statistic:  34.7 on 5 and 66 DF,  p-value: < 2.2e-16\n```\n:::\n\n```{.r .cell-code}\nanova(m1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Variance Table\n\nResponse: count\n          Df Sum Sq Mean Sq F value    Pr(>F)    \nspray      5 2668.8  533.77  34.702 < 2.2e-16 ***\nResiduals 66 1015.2   15.38                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\n### Checar as premissas de normalidade e heterogeneidade\n\n\n::: {.cell hash='TRANSFORMACAO_cache/html/unnamed-chunk-4_49878d3f76274ef5a209a48a376115ae'}\n\n```{.r .cell-code}\nlibrary(performance)\ncheck_normality(m1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nWarning: Non-normality of residuals detected (p = 0.022).\n```\n:::\n\n```{.r .cell-code}\ncheck_heteroskedasticity(m1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nWarning: Heteroscedasticity (non-constant error variance) detected (p < .001).\n```\n:::\n\n```{.r .cell-code}\nhist(m1$residuals)\n```\n\n::: {.cell-output-display}\n![](TRANSFORMACAO_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\nO conjunto de dados não atendeu as premissas de normalidade e heterogeneidade, agora seguiremos com a transformação\n\n## Transformaação raíz quadrada\n\nPara transformar os dados em raiz quadrada, usamos a função mutate e sqrt.\n\n\n::: {.cell hash='TRANSFORMACAO_cache/html/unnamed-chunk-5_571ef53fc424128fb32827ba58698387'}\n\n```{.r .cell-code}\ninseticida <- inseticida %>% \n  mutate(count2 = sqrt(count))\n\ninseticida |> \n  ggplot(aes(spray, count2)) +\n  geom_boxplot()\n```\n\n::: {.cell-output-display}\n![](TRANSFORMACAO_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n\n```{.r .cell-code}\nm1 <- lm(count2 ~ spray,\n         data = inseticida)\n\nanova(m1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Variance Table\n\nResponse: count2\n          Df Sum Sq Mean Sq F value    Pr(>F)    \nspray      5 88.438 17.6876  44.799 < 2.2e-16 ***\nResiduals 66 26.058  0.3948                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\n#### checar as premissas depois da transformação\n\n\n::: {.cell hash='TRANSFORMACAO_cache/html/unnamed-chunk-6_e647d25ed1c751aa43296718132f2b14'}\n\n```{.r .cell-code}\nlibrary(performance)\ncheck_normality(m1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nOK: residuals appear as normally distributed (p = 0.681).\n```\n:::\n\n```{.r .cell-code}\ncheck_heteroscedasticity(m1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nOK: Error variance appears to be homoscedastic (p = 0.854).\n```\n:::\n\n```{.r .cell-code}\nlibrary(DHARMa)\nplot(simulateResiduals(m1))\n```\n\n::: {.cell-output-display}\n![](TRANSFORMACAO_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n\n```{.r .cell-code}\nhist(m1$residuals)\n```\n\n::: {.cell-output-display}\n![](TRANSFORMACAO_files/figure-html/unnamed-chunk-6-2.png){width=672}\n:::\n:::\n\n\n#### Teste de comparação de médias\n\n\n::: {.cell hash='TRANSFORMACAO_cache/html/unnamed-chunk-7_7469e67eff2096596a011ad19bb6bc56'}\n\n```{.r .cell-code}\nlibrary(emmeans)\nm1_medias <- emmeans(m1, ~spray)\nplot(m1_medias)\n```\n\n::: {.cell-output-display}\n![](TRANSFORMACAO_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n\n```{.r .cell-code}\nlibrary(multcomp)\ncld(m1_medias)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n spray emmean    SE df lower.CL upper.CL .group\n C       1.24 0.181 66    0.883     1.61  1    \n E       1.81 0.181 66    1.447     2.17  12   \n D       2.16 0.181 66    1.802     2.53   2   \n A       3.76 0.181 66    3.399     4.12    3  \n B       3.88 0.181 66    3.514     4.24    3  \n F       4.02 0.181 66    3.656     4.38    3  \n\nConfidence level used: 0.95 \nP value adjustment: tukey method for comparing a family of 6 estimates \nsignificance level used: alpha = 0.05 \nNOTE: If two or more means share the same grouping symbol,\n      then we cannot show them to be different.\n      But we also did not show them to be the same. \n```\n:::\n:::\n\n\n## Transformação logaritmica\n\n\n::: {.cell hash='TRANSFORMACAO_cache/html/unnamed-chunk-8_64a89596e1c0ae835eaffafe12261878'}\n\n```{.r .cell-code}\nm2 <- lm(count2 ~ spray,\n         data = inseticida)\nanova(m2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Variance Table\n\nResponse: count2\n          Df Sum Sq Mean Sq F value    Pr(>F)    \nspray      5 88.438 17.6876  44.799 < 2.2e-16 ***\nResiduals 66 26.058  0.3948                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\nchecar se as premissas foram atendidas depois da transformação (normalidade e heterogeneidade)\n\n\n::: {.cell hash='TRANSFORMACAO_cache/html/unnamed-chunk-9_8b3ef4be5a7f261c0b208cf349930d8b'}\n\n```{.r .cell-code}\nlibrary(performance)\ncheck_normality(m2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nOK: residuals appear as normally distributed (p = 0.681).\n```\n:::\n\n```{.r .cell-code}\ncheck_heteroscedasticity(m2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nOK: Error variance appears to be homoscedastic (p = 0.854).\n```\n:::\n\n```{.r .cell-code}\nhist(m2$residuals)\n```\n\n::: {.cell-output-display}\n![](TRANSFORMACAO_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\nA transformação logaritmica foi atendida para os pressupostos\n\n## Teste não paramétrico\n\nUsando kruskal.test\n\n\n::: {.cell hash='TRANSFORMACAO_cache/html/unnamed-chunk-10_5ef28255c793d75beba2ba860b1ce0fb'}\n\n```{.r .cell-code}\nlibrary(agricolae)\nkruskal.test(count ~ spray,\n             data = inseticida)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tKruskal-Wallis rank sum test\n\ndata:  count by spray\nKruskal-Wallis chi-squared = 54.691, df = 5, p-value = 1.511e-10\n```\n:::\n\n```{.r .cell-code}\n#rejeitou a hipotese nula\n\nm3 <- kruskal(inseticida$count,\n        inseticida$spray,\n        group = TRUE)\nm3\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n$statistics\n     Chisq Df      p.chisq  t.value      MSD\n  54.69134  5 1.510845e-10 1.996564 8.462804\n\n$parameters\n            test p.ajusted           name.t ntr alpha\n  Kruskal-Wallis      none inseticida$spray   6  0.05\n\n$means\n  inseticida.count     rank      std  r Min Max   Q25  Q50   Q75\nA        14.500000 52.16667 4.719399 12   7  23 11.50 14.0 17.75\nB        15.333333 54.83333 4.271115 12   7  21 12.50 16.5 17.50\nC         2.083333 11.45833 1.975225 12   0   7  1.00  1.5  3.00\nD         4.916667 25.58333 2.503028 12   2  12  3.75  5.0  5.00\nE         3.500000 19.33333 1.732051 12   1   6  2.75  3.0  5.00\nF        16.666667 55.62500 6.213378 12   9  26 12.50 15.0 22.50\n\n$comparison\nNULL\n\n$groups\n  inseticida$count groups\nF         55.62500      a\nB         54.83333      a\nA         52.16667      a\nD         25.58333      b\nE         19.33333     bc\nC         11.45833      c\n\nattr(,\"class\")\n[1] \"group\"\n```\n:::\n:::\n\n\n## Transformação GLMs (modelo linear generalizado)\n\n\n::: {.cell hash='TRANSFORMACAO_cache/html/unnamed-chunk-11_1bd0bcbb75b7f7f823db8eea2d495108'}\n\n```{.r .cell-code}\nm4 <- glm(count ~ spray,\n          family = poisson, \n          data = inseticida)\nsummary(m4)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = count ~ spray, family = poisson, data = inseticida)\n\nCoefficients:\n            Estimate Std. Error z value Pr(>|z|)    \n(Intercept)  2.67415    0.07581  35.274  < 2e-16 ***\nsprayB       0.05588    0.10574   0.528    0.597    \nsprayC      -1.94018    0.21389  -9.071  < 2e-16 ***\nsprayD      -1.08152    0.15065  -7.179 7.03e-13 ***\nsprayE      -1.42139    0.17192  -8.268  < 2e-16 ***\nsprayF       0.13926    0.10367   1.343    0.179    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 409.041  on 71  degrees of freedom\nResidual deviance:  98.329  on 66  degrees of freedom\nAIC: 376.59\n\nNumber of Fisher Scoring iterations: 5\n```\n:::\n\n```{.r .cell-code}\nanova(m4)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Deviance Table\n\nModel: poisson, link: log\n\nResponse: count\n\nTerms added sequentially (first to last)\n\n      Df Deviance Resid. Df Resid. Dev\nNULL                     71     409.04\nspray  5   310.71        66      98.33\n```\n:::\n\n```{.r .cell-code}\nlibrary(car)\nAnova(m4) #a função Anova com letra maiúscula\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Deviance Table (Type II tests)\n\nResponse: count\n      LR Chisq Df Pr(>Chisq)    \nspray   310.71  5  < 2.2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\n#pressupostos\nplot(simulateResiduals(m4))\n```\n\n::: {.cell-output-display}\n![](TRANSFORMACAO_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n\n```{.r .cell-code}\nm4_medias <- emmeans(m4, ~ spray,\n                     type = \"response\")\nm4_medias\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n spray  rate    SE  df asymp.LCL asymp.UCL\n A     14.50 1.099 Inf     12.50     16.82\n B     15.33 1.130 Inf     13.27     17.72\n C      2.08 0.417 Inf      1.41      3.08\n D      4.92 0.640 Inf      3.81      6.35\n E      3.50 0.540 Inf      2.59      4.74\n F     16.67 1.179 Inf     14.51     19.14\n\nConfidence level used: 0.95 \nIntervals are back-transformed from the log scale \n```\n:::\n\n```{.r .cell-code}\ncld(m4_medias)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n spray  rate    SE  df asymp.LCL asymp.UCL .group\n C      2.08 0.417 Inf      1.41      3.08  1    \n E      3.50 0.540 Inf      2.59      4.74  12   \n D      4.92 0.640 Inf      3.81      6.35   2   \n A     14.50 1.099 Inf     12.50     16.82    3  \n B     15.33 1.130 Inf     13.27     17.72    3  \n F     16.67 1.179 Inf     14.51     19.14    3  \n\nConfidence level used: 0.95 \nIntervals are back-transformed from the log scale \nP value adjustment: tukey method for comparing a family of 6 estimates \nTests are performed on the log scale \nsignificance level used: alpha = 0.05 \nNOTE: If two or more means share the same grouping symbol,\n      then we cannot show them to be different.\n      But we also did not show them to be the same. \n```\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}